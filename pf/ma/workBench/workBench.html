<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<title>工作台</title>
		<meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
		<style>
			[v-cloak] {
				display: none;
			}
			* {
				padding: 0;
				margin: 0;
			}
			.clear{
				clear: both;
			}
			.container {
				padding: 17px 25px 20px;
			}
			.container .row {
				margin-bottom: 18px;
			}
			.container .title-wrap {
				width: 14%;
				float: left;
				height: 70px;
				background: rgba(247,247,247,1);
				border-radius: 4px;
				border: 1px solid rgba(238,238,238,1);
				font-family: AlibabaPuHuiTi-Medium,AlibabaPuHuiTi;
				font-weight: 500;
				text-align: center;
				position: absolute;
			}
			.container .title-wrap .content {
				position: relative;
				top: 50%;
				transform: translateY(-50%);
			}
			.container .title-wrap .title {
				font-size: 14px;
				color: rgba(51,51,51,1);
				line-height: 20px;
			}
			.container .title-wrap .count {
				margin-top: 3px;
				font-size: 16px;
				color: #0066FF;
				line-height: 22px;
			}
			.container .item-wrap {
				width: calc(86% - 55px);
				float: left;
				padding: 0 0 0 calc(14% + 55px);
				display: -webkit-flex;
				display: flex;
				justify-content: space-around;
			}
			.container .item-wrap .item-content {
				width: 100%;
				line-height: 72px;
				position: relative;
				font-size: 16px;
				font-family: AlibabaPuHuiTi-Medium,AlibabaPuHuiTi;
				font-weight: 500;
				color: #0066FF;
			}
			.container .item-wrap .content-wrap {
				float: left;
				display: -webkit-flex;
				display: flex;
				justify-content: space-between;
				margin: 10px;
				width: 80%;
			}
			.container .item-wrap .count-item {
				float: left;
				width: 52px;
				height: 52px;
				position: relative;
			}
			.container .item-wrap .count-item span {
				position: absolute;
				left: 50%;
				top: 50%;
				transform: translate(-50%, -50%);
			}
			.container .item-wrap .count-item::before {
				position: absolute;
				content: '';
				width: 48px;
				height: 48px;
				background: rgba(255,255,255,1);
				border: 2px solid #0066FF;
				border-radius: 50%;
			}
			.container .item-wrap .count-title {
				float: left;
				font-size: 14px;
				font-family: AlibabaPuHuiTi-Medium,AlibabaPuHuiTi;
				font-weight: 500;
				color: #0066FF;
			}
			.container .item-wrap .progress-item {
				float: left;
				line-height: 12px;
				margin-top: 10px;
			}
			.container .item-wrap .progress-item {
				line-height: 12px;
				margin-top: 4px;
			}
			.container .item-wrap .title {
				text-align: center;
				font-size: 12px;
				font-family: AlibabaPuHuiTi-Regular,AlibabaPuHuiTi;
				font-weight: 400;
				color: rgba(51,51,51,1);
				line-height: 17px;
				padding-bottom: 4px;
			}
			.container .item-wrap .icon {
				line-height: 12px;
			}
			.container .item-wrap .icon span {
				display: inline-block;
				width: 0; 
				height: 0; 
				border-top: 6px solid transparent;
				border-bottom: 6px solid transparent;
				border-left: 9px solid #bbb;
				margin-right: 5px;
			}
			.container .item-wrap .icon span:last-child {
				margin-right: 0px;
			}
			.container .orange .count,
			.container .orange .count-title,
			.container .item-wrap .orange .count-item span {
				color: #FF6633;
			}
			.container .orange .count-item::before {
				border:2px solid #FF6633;
			}
			.container .green .count,
			.container .green .count-title,
			.container .item-wrap .green .count-item span {
				color: #009900;
			}
			.container .green .count-item::before {
				border:2px solid #009900;
			}
			.container .bluesky .count,
			.container .bluesky .count-title,
			.container .item-wrap .bluesky .count-item span {
				color: #0099FF;
			}
			.container .bluesky .count-item::before {
				border:2px solid #0099FF;
			}
		</style>
	</head>

	<body>
		<div id="app" v-cloak>
			<div class="container">
				<div class="row">
					<div class="title-wrap">
						<div class="content">
							<div class="title">年度预算</div>
							<div class="count"><span>{{ annualBudget }}</span> 元</div>
						</div>
					</div>
					<div class="item-wrap">
						<div class="item-content">
							<span class="count-title">采购</span>
							<div class="content-wrap">
								<div class="count-item">
									<span>{{ upProcessNum.upDemandNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">需求</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ upProcessNum.upBiddingNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">招标</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ upProcessNum.upContractNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">合同</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ upProcessNum.upAcceptNum }}</span>
								</div>
							</div>
							<span class="count-title">验收</span>
						</div>
						<div class="item-content orange">
							<span class="count-title">合同</span>
							<div class="content-wrap">
								<div class="count-item">
									<span>{{ cmProcessNum.cmProposedNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">拟定</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ cmProcessNum.cmSignNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">会签</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ cmProcessNum.cmApprovalNum }}</span>
								</div>
								<div class="progress-item">
									<div class="title">审批</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ cmProcessNum.cmExecuteNum }}</span>
								</div>
							</div>
							<span class="count-title">履行</span>
						</div>
					</div>
					<div class="clear"></div>
				</div>

				<div class="row">
					<div class="title-wrap">
						<div class="content orange">
							<div class="title">资产总额</div>
							<div class="count"><span>{{ totalAssets }}</span> 元</div>
						</div>
					</div>
					<div class="item-wrap">
						<div class="item-content green">
							<span class="count-title">报销</span>
							<div class="content-wrap">
								<div class="count-item" v-for="item in countArBills" :key="item.id" v-if="item.STATUS === 'INITIAL'">
									<span>{{ item.COUNT }}</span>
								</div>
								<div class="progress-item">
									<div class="title">填报</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item" v-for="item in countArBills" :key="item.id" v-if="item.STATUS === 'AUDIT'">
									<span>{{ item.COUNT }}</span>
								</div>
								<div class="progress-item">
									<div class="title">审核</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item" v-for="item in countArBills" :key="item.id" v-if="item.STATUS === 'PAYED'">
									<span>{{ item.COUNT }}</span>
								</div>
								<div class="progress-item">
									<div class="title">付款</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item" v-for="item in countArBills" :key="item.id" v-if="item.STATUS === 'VOU'">
									<span>{{ item.COUNT }}</span>
								</div>
							</div>
							<span class="count-title">入账</span>
						</div>
						<div class="item-content bluesky">
							<span class="count-title">资产</span>
							<div class="content-wrap">
								<div class="count-item">
									<span>{{ faProcessNum[0].count }}</span>
								</div>
								<div class="progress-item">
									<div class="title">建卡</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ faProcessNum[1].count }}</span>
								</div>
								<div class="progress-item">
									<div class="title">使用</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ faProcessNum[2].count }}</span>
								</div>
								<div class="progress-item">
									<div class="title">维修</div>
									<div class="icon">
										<span v-for="i in icon"></span>
									</div>
								</div>
								<div class="count-item">
									<span>{{ faProcessNum[3].count }}</span>
								</div>
							</div>
							<span class="count-title">报废</span>
						</div>
					</div>
					<div class="clear"></div>
				</div>
			</div>
		</div>
		<script src="./vue@2.6.11.min.js?rev=@@hash"></script>
		<script src="./axios.min.js?rev=@@hash"></script>
		<script src="./base64.js?rev=@@hash"></script>
		<script>
			var app = new Vue({
				el: '#app',
				data: {
					icon: 4,
					commonData: {},
					annualBudget: 0, //年度预算
					totalAssets: 0, // 资产总额
					upProcessNum: { // 采购流程数据
						upDemandNum: 0, // 需求
						upBiddingNum: 0, // 招标
						upContractNum: 0, // 合同
						upAcceptNum: 0 // 验收
					},
					cmProcessNum: { //合同流程数据
						cmProposedNum: 0, // 拟定
						cmSignNum: 0, // 会签
						cmApprovalNum: 0, // 审批
						cmExecuteNum: 0 // 履行
					},
					countArBills: [ // 报销
						{
								"ORDER":0,
								"STATUS":"ALL",
								"COUNT": 0,
								"STATUS_NAME":"全部"
						},
						{
								"ORDER":1,
								"STATUS":"INITIAL",
								"COUNT": 0,
								"STATUS_NAME":"填报"
						},
						{
								"ORDER":2,
								"STATUS":"AUDIT",
								"COUNT": 0,
								"STATUS_NAME":"审核"
						},
						{
								"ORDER":3,
								"STATUS":"PAYED",
								"COUNT": 0,
								"STATUS_NAME":"付款"
						},
						{
								"ORDER":4,
								"STATUS":"VOU",
								"COUNT": 0,
								"STATUS_NAME":"入账"
						}
					],
					faProcessNum: [ // 资产：1、建卡，2、使用，3、维修，4报废
						{
							id: 1,
							count: 0,
						},{
							id: 2,
							count: 0,
						},{
							id: 3,
							count: 0,
						},{
							id: 4,
							count: 0,
						},
					],
					upProcess: [
						{
							id: 1,
							title: '需求',
						},{
							id: 2,
							title: '招标',
						},{
							id: 3,
							title: '合同',
						},
					],
					cmProcess: [
						{
							id: 1,
							title: '拟定',
						},{
							id: 2,
							title: '会签',
						},{
							id: 3,
							title: '审批',
						},
					],
					arProgress: [
						{
							id: 1,
							title: '填报',
						},{
							id: 2,
							title: '审核',
						},{
							id: 3,
							title: '付款',
						},
					],
					faProgress: [
						{
							id: 1,
							title: '建卡',
						},{
							id: 2,
							title: '使用',
						},{
							id: 3,
							title: '维修',
						},
					],
				},
				filters: {
				},
				mounted () {
					if (document.body.clientWidth <= 1200) {
						this.icon = 3;
					} else {
						this.icon = 4;
					}
					this.getCommonData();
					this.getSumBudget();
					this.upExecondition();
					this.cmExecondition();
					this.countArBill();
					for (let i = 1; i < 5; i++) {
						this.getSumCardStat(i);
					}
				},
				methods: {
					getCommonData () {
						var portalCommonData = JSON.parse(localStorage.getItem("commonData"));
						this.commonData = {
							svAgencyCode: Base64.decode(portalCommonData.svAgencyCode),
							svFiscalPeriod: Base64.decode(portalCommonData.svFiscalPeriod),
							svSetYear: Base64.decode(portalCommonData.svSetYear),
							svRgCode: Base64.decode(portalCommonData.svRgCode),
							//区划为空Base64.decode(portalCommonData.svRgCode),
							svTransDate: Base64.decode(portalCommonData.svTransDate),
							svUserId: Base64.decode(portalCommonData.svUserId),
							svRoleName: Base64.decode(portalCommonData.svRoleName),
							svSysDate: Base64.decode(portalCommonData.svSysDate),
							svRoleCode: Base64.decode(portalCommonData.svRoleCode),
							svAcctCode: Base64.decode(portalCommonData.svAcctCode),
							svAcctName: Base64.decode(portalCommonData.svAcctName),
							svUserCode: Base64.decode(portalCommonData.svUserCode),
							svMenuId: Base64.decode(portalCommonData.svMenuId),
							//菜单id为空
							svUserName: Base64.decode(portalCommonData.svUserName),
							svAgencyName: Base64.decode(portalCommonData.svAgencyName),
							svRgName: Base64.decode(portalCommonData.svRgName),
							//区划名称为空
							token: Base64.decode(portalCommonData.token)
						}
					},
					// 年度预算 -孙爽
					getSumBudget () {
						let that = this;
						axios.get('/bg/report/getSumBudget?agencyCode=' + that.commonData.svAgencyCode +'&rgCode=' + that.commonData.svRgCode + '&setYear=' + that.commonData.svSetYear)
							.then(function (response) {
								if (response.data.flag == "success") {
									that.annualBudget = response.data.data;
								}
							})
							.catch(function (error) {
								console.log(error);                  
							});
					},
					// 采购 -邢启
					upExecondition () {
						let that = this;
						axios.post('/up/api/workbench/upexecondition', {})
							.then(function (response) {
								if (response.data.status == "success") {
									that.upProcessNum = response.data.data;
								}
							})
							.catch(function (error) {
								console.log(error);                  
							});
					},
					// 合同 -邢启
					cmExecondition () {
						let that = this;
						axios.post('/up/api/workbench/cmexecondition', {})
							.then(function (response) {
							if (response.data.status == "success") {
									that.cmProcessNum = response.data.data;
								}
							})
							.catch(function (error) {
								console.log(error);                  
							});
					},
					// 报销-鑫淼
					// 可传单位(coCode)或者用户编码(userCode)，传单位则统计单位下的报销单，传用户编码则统计用户填报的单据，拼在接口url后面即可，例如：
					// http://localhost:8082/A/ar/api/interface/countArBill?userCode=200899
					// http://localhost:8082/A/ar/api/interface/countArBill?coCode=048098
					countArBill () {
						let that = this;
						// axios.get('/A/ar/api/interface/countArBill?coCode=048098')
						axios.get('/A/ar/api/interface/countArBill?userCode=' + that.commonData.svUserCode)
							.then(function (response) {
								if (response.data.flag == "SUCCESS") {
									that.countArBills = response.data.data;
								}
							})
							.catch(function (error) {
								console.log(error);                  
							});
					},
					// 资产-高健鹏
					getSumCardStat (queryType) {
						let that = this;
						// 单位orgCode
						// 查询类型queryType: 1、建卡，2、使用，3、维修，4报废
						axios.get('/fa/api/card/getSumCardStat?orgCode=' + that.commonData.svAgencyCode + '&queryType=' + queryType)
							.then(function (response) {
								if (response.data.flag == "SUCCESS") {
									if (response.data && response.data.data && (response.data.data[0] || response.data.data[0] == 0)) {
										if (queryType == 1) that.totalAssets = response.data.data[0].ORIGINVALUE ? response.data.data[0].ORIGINVALUE : 0;
										that.faProcessNum[queryType - 1].count = response.data.data[0].SHUL ? response.data.data[0].SHUL : 0;
									} else {
										if (queryType == 1) that.totalAssets = 0;
										that.faProcessNum[queryType - 1].count = 0;
									}
								}
							})
							.catch(function (error) {
								console.log(error);                  
							});
					},
				}
			})
		</script>
	</body>
</html>